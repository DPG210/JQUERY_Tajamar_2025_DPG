<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Maestro detalle empleados departamentos</h1>
 
    <div id="cajadepartamentos"></div>
    <table id="tabladepartamentos" style="text-align: center;" border="1">
        <thead>
            <tr>
                <th>Apellido</th>
                <th>Oficio</th>
                <th>Salario</th>
                <th>Departamento</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    
    <script src="js/jquery-3.7.1.js"></script>
    <script>
        let url="https://apicruddepartamentospgs.azurewebsites.net/";
        let url2="https://apiempleadosspgs.azurewebsites.net/";
        $(document).ready(function(){
            loadDepartamentos();
        })
        function loadDepartamentos(){
            console.log("Entrando");
            let request="webresources/departamentos";

            $.ajax({
                url:url+request,
                type:"GET",
                dataType:"json",
                success:function(data){
                    console.log("Dentro del primer get");
                    $.each(data,function(index,departamento){
                        var li=$("<li>");
                            li.text(departamento.nombre);

                        var boton=$("<button>");
                            boton.text("Empleados");
                            boton.val(departamento.numero);

                        li.append(boton);
                        $("#cajadepartamentos").append(li);

                        boton.click(function(){
                            console.log("Entrado en el boton");
                            var id=$(this).val();
                            let request2="api/Empleados/EmpleadosDepartamento/"+id;

                            $.ajax({
                                url:url2+request2,
                                type:"GET",
                                dataType:"json",
                                success:function(data){
                                    var html="";
                                    $.each(data,function(index,empleado){
                                    
                            
                                    
                                    
                                    console.log("Dentro de empleados");
                                        
                                    html+="<tr>";
                                    html+="<td>"+empleado.apellido+"</td>";
                                    html+="<td>"+empleado.oficio+"</td>";
                                    html+="<td>"+empleado.salario+"</td>";
                                    html+="<td>"+empleado.departamento+"</td>";
                                    html+="</tr>";

                                        $("#tabladepartamentos tbody").html(html);
                                    })
                                    
                                    
                                    
                                }
                            })


                        })
                    })
                }
            })

        }
    </script>
</body>
</html>